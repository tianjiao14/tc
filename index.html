<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä½“è´¨å¥åº·æµ‹è¯•åˆ†æç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Microsoft YaHei', sans-serif; background-color: #f2f2f2; font-size: 13px; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* å·¥å…·æ  */
        .toolbar { background: #217346; color: white; padding: 8px 10px; display: flex; flex-wrap: wrap; align-items: center; gap: 8px; min-height: 50px; flex-shrink: 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 60; }
        .app-title { font-weight: bold; font-size: 1.2rem; margin-right: 15px; white-space: nowrap; }
        
        .btn { background: #f3f3f3; border: 1px solid #ccc; color: #333; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 5px; white-space: nowrap; user-select: none; transition: all 0.1s; }
        .btn:active { background: #e0e0e0; transform: translateY(1px); }
        .btn-green { background: #4caf50; color: white; border: none; }
        .btn-red { background: #f44336; color: white; border: none; }
        .btn-blue { background: #2196f3; color: white; border: none; }
        .btn-purple { background: #9c27b0; color: white; border: none; }
        .btn-orange { background: #ff9800; color: white; border: none; }
        .btn-warn-nav { background: #d32f2f; color: white; border: 2px solid white; animation: pulse 2s infinite; display: none; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        
        .pagination { display: flex; align-items: center; gap: 5px; margin-left: auto; background: rgba(0,0,0,0.2); padding: 4px 8px; border-radius: 4px; }
        .page-info { font-size: 13px; color: #fff; font-weight: bold; font-family: monospace; min-width: 150px; text-align: center; }

        .tabs { display: flex; background: #fff; border-bottom: 1px solid #ccc; padding-left: 10px; height: 40px; align-items: flex-end; flex-shrink: 0; }
        .tab { padding: 8px 25px; cursor: pointer; border: 1px solid transparent; border-bottom: none; border-radius: 4px 4px 0 0; color: #666; font-size: 14px; margin-right: 2px; }
        .tab.active { border-color: #ccc; border-bottom-color: #fff; background: #fff; color: #217346; font-weight: bold; margin-bottom: -1px; z-index: 5; }

        .excel-container { flex: 1; overflow: auto; background: white; border-top: 1px solid #d4d4d4; position: relative; scroll-behavior: smooth; }

        /* è¡¨æ ¼æ ·å¼ */
        table { table-layout: fixed; border-collapse: separate; border-spacing: 0; min-width: 100%; white-space: nowrap; border-left: 1px solid #a0a0a0; }
        th, td { border-right: 1px solid #a0a0a0; border-bottom: 1px solid #a0a0a0; padding: 0; text-align: center; height: 34px; box-sizing: border-box; overflow: hidden; }
        thead tr:first-child th { position: sticky; top: 0; z-index: 50; height: 35px; border-bottom: 1px solid #a0a0a0; }
        thead tr:last-child th { position: sticky; top: 35px; z-index: 50; height: 35px; border-bottom: 3px solid #444 !important; }

        /* åˆ—å®½è®¾ç½® */
        .col-id { width: 60px; min-width: 60px; } 
        .col-class { width: 70px; min-width: 70px; } 
        .col-code { width: 130px; min-width: 130px; } 
        .col-name { width: 75px; min-width: 75px; }
        .col-addr { width: 150px; min-width: 150px; }
        .col-std { width: 60px; min-width: 60px; }
        .col-w-xs { width: 45px; min-width: 45px; }
        
        input.cell-input { width: 100%; height: 100%; border: none; outline: none; text-align: center; background: transparent; font-family: inherit; font-size: 13px; color: #000; font-weight: 500; }
        input[disabled] { background-color: #f9f9f9; color: #ccc; cursor: not-allowed; }
        tbody tr:focus-within td { background-color: #fff9c4 !important; }
        .modified-data { background-color: #d1fae5 !important; }
        .modified-data input { color: #047857 !important; font-weight: bold; }
        .cell-warn { background-color: #ffebee !important; border: 2px solid #ef5350 !important; }
        .text-error { color: #d32f2f; font-weight: bold; }
        .row-focus-error td { animation: flash 1s 3; border-top: 2px solid red; border-bottom: 2px solid red; }
        @keyframes flash { 0% { background-color: #ffcdd2; } 50% { background-color: #fff; } 100% { background-color: #ffcdd2; } }

        /* é¢œè‰²ä¸æ ·å¼ */
        .bg-header-base { background-color: #ffffff; color: #000; font-weight: bold; }
        .bg-header-score { background-color: #ffff00; color: #000; font-weight: bold; }
        .text-exc { color: #008000; font-weight: bold; }
        .text-good { color: #0000ff; font-weight: bold; }
        .text-pass { color: #333; }
        .text-fail { color: #ff0000; font-weight: bold; background-color: #fff0f0; }
        .text-bmi-norm { color: #008000; font-weight: bold; }
        .text-bmi-warn { color: #ff9800; font-weight: bold; }
        .text-bmi-bad { color: #ff0000; font-weight: bold; background-color: #ffebee; }
        .text-total { color: #ff0000; font-weight: bold; font-size: 14px; text-decoration: underline; }
        .calc-cell { cursor: help; background-color: #fefefe; }
        .hidden { display: none; }
        
        /* æŠ¥è¡¨åŒºåŸŸ */
        .report-section { padding: 15px; background: white; overflow: auto; flex: 1; }
        .report-table { width: 100%; border-collapse: collapse; margin-bottom: 30px; font-size: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .report-table th, .report-table td { border: 1px solid #000; padding: 6px 4px; text-align: center; }
        .report-header-blue { background-color: #00b0f0; color: white; font-weight: bold; }
        .report-title { font-size: 16px; font-weight: bold; margin: 20px 0 10px; border-left: 6px solid #00b0f0; padding-left: 12px; color: #333; }
        
        @media (max-width: 640px) {
            .toolbar { justify-content: space-between; }
            .btn { flex-grow: 1; justify-content: center; padding: 8px; font-size: 12px;}
            .app-title { width: 100%; text-align: center; margin-bottom: 5px; margin-right: 0; }
            .pagination { width: 100%; justify-content: space-between; margin-top: 5px; order: 10; }
        }
    </style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
<div id="login-screen" class="fixed inset-0 bg-gray-800 flex items-center justify-center z-[100]">
    <div class="bg-white p-8 rounded-lg shadow-xl w-80 text-center">
        <h2 id="lock-title" class="text-xl font-bold mb-4 text-gray-700">ğŸ”’ ç³»ç»Ÿç™»å½•</h2>
        <p id="lock-tip" class="text-gray-500 text-sm mb-4">è¯·éªŒè¯èº«ä»½</p>
        
        <div class="mb-3 text-left">
            <label class="text-xs text-gray-400 ml-1">è´¦å·</label>
            <input type="text" id="userInput" class="w-full border border-gray-300 p-2 rounded text-lg outline-none focus:border-green-500" placeholder="è¯·è¾“å…¥å·¥å·/è´¦å·">
        </div>

        <div class="mb-6 text-left">
            <label class="text-xs text-gray-400 ml-1">å¯†ç </label>
            <input type="password" id="passInput" class="w-full border border-gray-300 p-2 rounded text-lg outline-none focus:border-green-500" placeholder="è¯·è¾“å…¥å¯†ç ">
        </div>

        <button id="loginBtn" onclick="doLogin()" class="w-full bg-green-600 text-white py-2 rounded font-bold hover:bg-green-700 transition">ç™»å½•ç³»ç»Ÿ</button>
        <p id="login-msg" class="text-red-500 text-xs mt-2 hidden">è´¦å·æˆ–å¯†ç é”™è¯¯</p>
    </div>
    

</div>  <div id="app-content" class="hidden" style="flex: 1; display: flex; flex-direction: column; overflow: hidden;">
    
    <div class="toolbar">
        <span class="app-title">ğŸ“Š ä½“æµ‹æ•°æ®ä¸­å¿ƒ</span>
        
        <input type="file" id="infoInput" accept=".xlsx,.xls" style="display:none" onchange="importBasicInfo(event)">
        <button class="btn btn-blue" onclick="document.getElementById('infoInput').click()">1ï¸âƒ£ å¯¼å…¥åŸºæœ¬ä¿¡æ¯</button>
        
        <input type="file" id="fileInput" accept=".xlsx,.xls" style="display:none" onchange="importExcel(event)">
        <button class="btn" onclick="document.getElementById('fileInput').click()">2ï¸âƒ£ å¯¼å…¥æˆç»©</button>
      
        
        <button class="btn btn-orange" onclick="runSmartCheck()">3ï¸âƒ£ ğŸ” æ™ºèƒ½æ ¡éªŒ</button>
        <button class="btn btn-warn-nav" id="btnWarnNav" onclick="scrollToNextWarn()">âš ï¸ å®šä½å¼‚å¸¸ (0)</button>
        <button class="btn" onclick="addNewRow()">â• è¡Œ</button>
        <button class="btn btn-green" onclick="exportAllData()">5ï¸âƒ£ å¯¼å‡ºå…¨æ ¡ä¸ŠæŠ¥è¡¨</button>
        <button class="btn btn-green" onclick="exportSplitClassExcel()">ğŸ“‚ åˆ†ç­å¯¼å‡º</button>
        <button class="btn btn-blue" onclick="exportAnalysisExcel()">ğŸ“Š å¯¼å‡ºç»Ÿè®¡æŠ¥å‘Š</button>
        
        <button class="btn btn-red" onclick="deleteCurrentClass()">ğŸ—‘ï¸ åˆ å½“å‰ç­</button>
        <button class="btn btn-red" onclick="clearTable()">ğŸ—‘ï¸ æ¸…ç©º</button>
        
        <div class="pagination">
            <button class="btn" onclick="changeClass(-1)">â—€ ä¸Šä¸€ç­</button>
            <span id="page-info" class="page-info">æš‚æ— æ•°æ®</span>
            <button class="btn" onclick="changeClass(1)">ä¸‹ä¸€ç­ â–¶</button>
        </div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchView('data')" id="tab-data">æ•°æ®å½•å…¥</div>
        <div class="tab" onclick="switchView('report')" id="tab-report">åˆ†ææŠ¥å‘Š</div>
    </div>

    <div id="view-data" class="excel-container">
        <table id="mainTable">
            <thead>
                <tr>
                    <th rowspan="2" class="bg-header-base col-id">å¹´çº§<br>ç¼–å·</th>
                    <th rowspan="2" class="bg-header-base col-id">ç­çº§<br>ç¼–å·</th>
                    <th rowspan="2" class="bg-header-base col-class">ç­çº§<br>åç§°</th>
                    <th rowspan="2" class="bg-header-base col-code">å­¦ç±å·</th>
                    <th rowspan="2" class="bg-header-base col-w-xs">æ°‘æ—</th>
                    <th rowspan="2" class="bg-header-base col-name">å§“å</th>
                    <th rowspan="2" class="bg-header-base col-w-xs">æ€§åˆ«</th>
                    <th rowspan="2" class="bg-header-base" style="width:90px; min-width:90px">å‡ºç”Ÿæ—¥æœŸ</th>
                    <th rowspan="2" class="bg-header-base col-addr">å®¶åº­ä½å€</th>

                    <th rowspan="2" class="bg-header-base col-std">èº«é«˜<br>(cm)</th>
                    <th rowspan="2" class="bg-header-base col-std">ä½“é‡<br>(kg)</th>
                    <th rowspan="2" class="bg-header-base col-std">è‚ºæ´»é‡<br>(ml)</th>
                    <th rowspan="2" class="bg-header-base col-std">50ç±³è·‘<br>(s)</th>
                    <th rowspan="2" class="bg-header-base col-std">åä½<br>ä½“å‰å±ˆ</th>
                    <th rowspan="2" class="bg-header-base col-std">ä¸€åˆ†é’Ÿ<br>ä»°å§èµ·å</th>
                    <th rowspan="2" class="bg-header-base col-std">ç«‹å®š<br>è·³è¿œ</th>
                    <th rowspan="2" class="bg-header-base col-std">å¼•ä½“<br>å‘ä¸Š</th>
                    <th rowspan="2" class="bg-header-base col-std">1000ç±³è·‘</th>
                    <th rowspan="2" class="bg-header-base col-std">800ç±³è·‘</th>
                    
                    <th colspan="2" class="bg-header-score">BMI(15%)</th>
                    <th colspan="2" class="bg-header-score">è‚ºæ´»é‡(15%)</th>
                    <th colspan="2" class="bg-header-score">50ç±³è·‘(20%)</th>
                    <th colspan="2" class="bg-header-score">ç«‹å®šè·³è¿œ(10%)</th>
                    <th colspan="2" class="bg-header-score">åä½ä½“å‰å±ˆ(10%)</th>
                    <th colspan="2" class="bg-header-score">800ç±³è·‘(20%)</th>
                    <th colspan="2" class="bg-header-score">1000ç±³è·‘(20%)</th>
                    <th colspan="2" class="bg-header-score">ä»°å§èµ·å(10%)</th>
                    <th colspan="2" class="bg-header-score">å¼•ä½“å‘ä¸Š(10%)</th>
                    
                    <th rowspan="2" class="bg-header-score col-w-xs">é™„åŠ <br>åˆ†</th>
                    <th rowspan="2" class="bg-header-score col-std" style="color:red">æ€»åˆ†</th>
                    <th rowspan="2" class="bg-header-score col-std">ç­‰çº§</th>
                    <th rowspan="2" class="bg-header-base col-w-xs">åˆ </th>
                </tr>
                <tr id="subHeader"></tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <div id="view-report" class="report-section hidden">
    <div class="report-title">1. å…¨æ ¡æ•°æ®æ±‡æ€»</div>
    <div id="report-overall" style="overflow-x:auto;"></div>
    <div style="height: 350px;"><canvas id="chart-overall"></canvas></div> 
    
    <div class="report-title">2. å„é¡¹ç›®ä¼˜è‰¯ç‡ (ç”·å¥³åˆ†é¡¹)</div>
    <div id="report-items" style="overflow-x:auto;"></div>
    <div style="height: 350px;"><canvas id="chart-items"></canvas></div>

    <div class="report-title">3. ç­çº§è¯¦æƒ…åˆ†æ</div>
    <div id="report-class" style="overflow-x:auto;"></div>
    <div style="height: 350px;"><canvas id="chart-class"></canvas></div> 
</div>
    
</div> 

<script src="app.js"></script>
</body>
</html>
